
<nav id="nav-bar">
    <ul>
        <li class="logo">Cloud 17</li>
        <!--<li class="btn"> <span class="fas fa-bars"></span> </li>-->
        <div class="items">
            <li><a href="/homepage">Home</a> </li>
            <li><a href="/shared">Shared</a> </li>
            <li><a href="/users/logout">Log Out</a> </li>
        </div>
        <li class="search-icon">
            <input type="search" placeholder="Search...">
            <label class="icon">
                <span class="fas fa-search"></span>
            </label>
        </li>
    </ul>
</nav>

<div class="main">

    <div class="top-section">
        <h1 id="regard"> Hello, <%= username %>! </h1>
        <span id ='user_email' data-id="<%= email %>"></span>

        <p>This is your homepage with all your files.</p>
        <p>To upload: Choose then Upload.</p>
        <form action="/api/uploadFile" enctype="multipart/form-data" method="POST">
            <label class="custom-upload">
                <input type="file" class="admin__input" id="myFile" name="myFile"/>
                Choose File
            </label>

            <!--<input type="file" id="myFile" name="filename">-->
            <label class="custom-submit">
                <input class="admin__submit" type="submit", id="submit">
                Submit
            </label>

        </form>
    </div>
    <ul class="cards">
    </ul>
    <!-- <ul class="cards">
        <li class="cards_item">
            <div class="card">
                <div class="card_image"><img src="/images/file_blue.png"></div>
                <div class="card_content">
                    <h2 class="card_title" id="fname">FILE NAME</h2>
                    <h3 class="card_text" id="size">Size: </h3>
                    <h3 class="card_text" id="date">Date: </h3>
                    <button class="btn card_btn">Download</button>
                    <button class="btn card_btn">Share</button>
                    <button class="btn card_btn">Delete</button>
                </div>
            </div>
        </li>
        <li class="cards_item">
            <div class="card">
                <div class="card_image"><img src="/images/file_blue.png"></div>
                <div class="card_content">
                    <h2 class="card_title">FILE NAME</h2>
                    <p class="card_text">Size: </p>
                    <p class="card_text">Date: </p>
                    <button class="btn card_btn">Download</button>
                    <button class="btn card_btn">Share</button>
                    <button class="btn card_btn">Delete</button>
                </div>
            </div>
        </li>
        <li class="cards_item">
            <div class="card">
                <div class="card_image"><img src="/images/file_blue.png"></div>
                <div class="card_content">
                    <h2 class="card_title">FILE NAME</h2>
                    <p class="card_text">Size: </p>
                    <p class="card_text">Date: </p>
                    <button class="btn card_btn">Download</button>
                    <button class="btn card_btn">Share</button>
                    <button class="btn card_btn">Delete</button>
                </div>
            </div>
        </li>
        <li class="cards_item">
            <div class="card">
                <div class="card_image"><img src="/images/file_blue.png"></div>
                <div class="card_content">
                    <h2 class="card_title">FILE NAME</h2>
                    <p class="card_text">Size: </p>
                    <p class="card_text">Date: </p>
                    <button class="btn card_btn">Download</button>
                    <button class="btn card_btn">Share</button>
                    <button class="btn card_btn">Delete</button>
                </div>
            </div>
        </li>

    </ul> -->
</div>

<h3 class="made_by">Team 17</h3>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    const parentDiv = document.querySelector(".cards");
    window.addEventListener("load", async () => {
      try {
        let result = await axios({
          method: "GET",
          url: "/api/getFiles",
        });
        let files = result.data.files;
        const email = document.getElementById('user_email').getAttribute('data-id');

        files.forEach((file) => {
            if (file.owner === email){
                markup = `

<li class="cards_item">
            <div class="card">
                <div class="card_image"><img src="/images/file_blue.png"></div>
                <div class="card_content">
                    <h2 class="card_title" id="fname">${file.name}</h2>
                    <h3 class="card_text" id="size">Size: ${file.size}</h3>
                    <h3 class="card_text" id="date">Date: ${file.createdAt}</h3>
                    <button class="btn card_btn" data-id=${file._id}>Download</button>
                    <button class="btn card_btn">Share</button>
                    <button class="btn card_btn">Delete</button>
                </div>
            </div>
        </li>

<!--
                <div class="files__entity">
                  <i class="files__icon fa fa-file-text" aria-hidden="true"></i>
                  <span class="files__date">${file.name}, Date created:- ${file.createdAt}</span>
                  <a href="${file.name}" class="files__link"><i class="fa fa-eye tests__icon" aria-hidden="true"></i></a>
                </div> -->
              `;
                parentDiv.insertAdjacentHTML("beforeend", markup);
            }
        });
      } catch (error) {
        console.log(error);
      }
    });


    function download(filename, textInput) {

        var element = document.createElement('a');
        element.setAttribute('href','data:text/plain;charset=utf-8, ' + encodeURIComponent(textInput));
        element.setAttribute('download', filename);
        document.body.appendChild(element);
        element.click();
        //document.body.removeChild(element);
    }
    document.getElementsByClassName("btn card_btn")[0]
        .addEventListener("click", function () {
            var text = document.getElementById("text").value;
            var filename = "output.txt";
            download(filename, text);
        }, false);

  </script>
